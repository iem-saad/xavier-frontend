<style>
  .water{
      width:200px;
      height: 200px;
      background-color: skyblue;
      border-radius: 50%;
      position: relative;
      box-shadow: inset 0 0 30px 0 rgba(0,0,0,.5), 0 4px 10px 0 rgba(0,0,0,.5);
      overflow: hidden;
  }
  .water:before, .water:after{
      content:'';
      position: absolute;
      width:200px;
      height: 400px;
      top:-220px;
      background-color: #fff;
  }
  .water:before{
      border-radius: 35%;
      background:rgba(255,255,255,.7);
      animation:wave 5s linear infinite;
  }
  .water:after{
      border-radius: 25%;
      background:rgba(255,255,255,.3);
      animation:wave 5s linear infinite;
  }
  @keyframes wave{
      0%{
          transform: rotate(0);
      }
      100%{
          transform: rotate(360deg);
      }
  }
</style>
<div class="row">
  <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-capitalize font-weight-bold">Project Name</p>
              <h5 class="font-weight-bolder mb-0">
                <%= @project.name %>
              </h5>
            </div>
          </div>
          <div class="col-4 text-end">
            <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
              <i class="fa fa-file text-lg opacity-10" aria-hidden="true"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-capitalize font-weight-bold">Original Models</p>
              <h5 class="font-weight-bolder mb-0">
                <%= @project.original_models.count %>
              </h5>
            </div>
          </div>
          <div class="col-4 text-end">
            <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
              <i class="fa fa-file text-lg opacity-10" aria-hidden="true"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-capitalize font-weight-bold"> Mutated Models</p>
              <h5 class="font-weight-bolder mb-0">
                <%= @project.original_models.count %>
              </h5>
            </div>
          </div>
          <div class="col-4 text-end">
            <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
              <i class="fa fa-file text-lg opacity-10" aria-hidden="true"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-3 col-sm-6">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-capitalize font-weight-bold">Value of K</p>
              <h5 class="font-weight-bolder mb-0">
                <%= @project.hyper_params.dig("k_value") %>
              </h5>
            </div>
          </div>
          <div class="col-4 text-end">
            <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
              <i class="fa fa-file text-lg opacity-10" aria-hidden="true"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row my-3">
  <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-capitalize font-weight-bold">Project Status</p>
              <h5 class="font-weight-bolder mb-0 badge badge-sm bg-gradient-<%= @project.completed? ? 'success' : 'secondary' %>">
                <%= @project.status %>
              </h5>
            </div>
          </div>
          <div class="col-4 text-end">
            <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
              <i class="fa fa-file text-lg opacity-10" aria-hidden="true"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-capitalize font-weight-bold">Model Selected</p>
              <p class="font-weight-bolder mb-0">
                <%= @project.hyper_params.dig("model") %>
              </p>
            </div>
          </div>
          <div class="col-4 text-end">
            <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
              <i class="fa fa-file text-lg opacity-10" aria-hidden="true"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 font-weight-bold"> Mutation at layer</p>
              <h5 class="font-weight-bolder mb-0">
                <%= @project.hyper_params.dig("layer") %>
              </h5>
            </div>
          </div>
          <div class="col-4 text-end">
            <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
              <i class="fa fa-layer-group text-lg opacity-10" aria-hidden="true"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-3 col-sm-6">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-capitalize font-weight-bold">Operator Applied</p>
              <h6 class="font-weight-bolder mb-0">
                <%= @project.hyper_params.dig("operator_params")["operator"] %>
              </h6>
            </div>
          </div>
          <div class="col-4 text-end">
            <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
              <i class="fa fa-file text-lg opacity-10" aria-hidden="true"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="row mt-4">
  <div class="col-lg-7 mb-lg-0 mb-4">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-lg-6">
            <div class="d-flex flex-column h-100">
              <h5 class="font-weight-bolder">Project Description</h5>
              <p class="mb-5"><%= @project.description %></p>
              <a class="text-body text-sm font-weight-bold mb-0 icon-move-right mt-auto" href="javascript:;">
               Project was Created <%= time_ago_in_words(@project.created_at)%> ago
              </a>
            </div>
          </div>
          <div class="col-lg-5 ms-auto text-center mt-5 mt-lg-0">
            <div class="bg-gradient-primary border-radius-lg h-100">
              <div class="position-relative d-flex align-items-center justify-content-center h-100">
                <%= image_tag "neural_net.png", class: "position-relative z-index-2", style: "height: 150px;" %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-5">
    <div class="card h-100 p-3">
      <div class="overflow-hidden position-relative border-radius-lg bg-cover h-100">
        <span class="mask bg-gradient-primary"></span>
        <div class="card-body position-relative z-index-1 d-flex flex-column h-100 p-3">
          <h5 class="text-white font-weight-bolder mb-4 pt-2">Operator Configurations are as following.</h5>
          <p class="text-white"><%= operator_conf(@project) %></p>
        </div>
      </div>
    </div>
  </div>
</div>
<% if @project.in_progress? %>
<div class="row">
  <div class="water my-4" style="margin-left: 40%;"></div>
  <div style="margin-left: 42%;"><h3>Processing...</h3>
  </div>
</div>
<% end %>
<div class="row card mt-4">
  <h3 class="p-3 mx-3">Mutation Analysis (Graphical)</h3>
  <div class="accordion accordion-flush" id="accordionFlushExample">
  <% @project.original_models.each_with_index do |model, index| %>
  <% next if model.mutated_model.nil? %>
    <div class="accordion-item card-body p-3">
      <h2 class="accordion-header" id="flush-heading<%=index%>">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse<%=index%>" aria-expanded="false" aria-controls="flush-collapse<%=index%>">
          <%= "#{@project.name}-#{@project.hyper_params&.dig("model")}-#{index+1}" %>
          <i class="fa fa-arrow-down mx-4 pull-right"></i>
        </button>
      </h2>
      <div id="flush-collapse<%=index%>" class="accordion-collapse collapse" aria-labelledby="flush-heading<%=index%>" data-bs-parent="#accordionFlushExample">
        <div class="accordion-body">
          <% model.matrices.each_with_index do |matrice, i| %>
            <% key = matrice.keys[0] %>
            <% org_data = matrice[key].values.map(&:to_f) %>
            <% mutated_data = model.mutated_model.matrices[i][key].values.map(&:to_f) %>

            <%= render 'linear_graph', type: key, id: key, org_data: org_data, mutated_data: mutated_data, index: index %>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
  </div>
</div>

<div class="row card mt-4">
  <h3 class="p-3 mx-3">Mutation Analysis (Tabular)</h3>
  <div class="accordion accordion-flush" id="accordionFlushExample">
  <% @project.original_models.each_with_index do |model, index| %>
  <% next if model.mutated_model.nil? %>
    <div class="accordion-item card-body p-3">
      <h2 class="accordion-header" id="tabular-flush-heading<%=index%>">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#tabular-flush-collapse<%=index%>" aria-expanded="false" aria-controls="tabular-flush-collapse<%=index%>">
          <%= "#{@project.name}-#{@project.hyper_params&.dig("model")}-#{index+1}" %>
          <i class="fa fa-arrow-down mx-4 pull-right"></i>
        </button>
      </h2>
      <div id="tabular-flush-collapse<%=index%>" class="accordion-collapse collapse" aria-labelledby="tabular-flush-heading<%=index%>" data-bs-parent="#accordionFlushExample">
        <div class="accordion-body">
          <% model.matrices.each_with_index do |matrice, i| %>
            <% key = matrice.keys[0] %>
            <% org_data = matrice[key].values.map(&:to_f) %>
            <% mutated_data = model.mutated_model.matrices[i][key].values.map(&:to_f) %>

            <%= render 'tabular_analysis_tile', org_vals: org_data, mutated_vals: mutated_data, title: key %>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
  </div>
</div>